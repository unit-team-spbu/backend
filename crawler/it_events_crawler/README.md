# IT-Events Crawler

Данный документ содержит описание работы и информацию о развертке микросервиса для сбора данных о мероприятиях с информационного ресурса [IT-Events](https://it-events.com/)

Название сервиса: `it_events_crawler`

Структура сервиса:

| Файл                   | Описание                                                                               |
| ---------------------- | -------------------------------------------------------------------------------------- |
| `it_events_crawler.py` | Код микросервиса, вместе с парсингом мероприятий с [IT-Events](https://it-events.com/) |
| `config.yml`           | Кофигурационный файл со строкой подключения к RabbitMQ                                 |
| `run.sh`               | Файд для запуска краулера из Docker контейнера                                         |
| `requirements.txt`     | Верхнеуровневые зависимости                                                            |
| `requirements.lock`    | Все зависимости (`pip freeze`)                                                         |
| `Dockerfile`           | Описание сборки контейнера краулера                                                    |
| `docker-compose.yml`   | Изолированная развертка краулера вместе с RabbitMQ                                     |
| `.rest`                | Тесты взаимодействия с HTTP эндпоинтами микросервиса                                   |
| `README.md`            | Описание микросервиса                                                                  |

## API

### RPC

```
rpc.it_events_crawler.get_upcoming_events()
```

Для меж сервисного взаимодействия

### HTTP

```rst
GET http://localhost:8000/events HTTP/1.1
```

Для прямого взаимодействия по HTTP, ручного тестирования

## Развертывание и запуск

### Локальный запуск

Для локального запуска микросервиса требуется запустить контейнер с RabbitMQ:

```bat
sudo docker run -p 5672:5672 --hostname nameko-rabbitmq rabbitmq:3
```

Затем из папки микросервиса вызвать

```bat
nameko run it_events_crawler
```

После чего можно проверить работоспособность сервиса через `.rest` файл (с расширением для VSCode/PyCharm), через Postman. Проверка таким образом производится по `http`.

Для проверки `rpc` запустите в командной строке:

```bat
nameko shell
```

После чего откроется интерактивная Python среда и обратитесь к сервису следующей командой:

```bat
n.rpc.it_events_crawler.get_upcoming_events()
```

### Запуск в контейнере

Чтобы запустить микросервис в контейнере из папки краулера вызовите команду:

```bat
docker-compose up
```

> если вы не хотите просмотривать логи, добавьте флаг `-d` в конце

Краулер запустится вместе с RabbitMQ в контейнерах.